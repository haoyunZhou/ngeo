{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./examples/permalink.js","webpack:///./src/format/FeatureHash.js","webpack:///./src/format/FeatureHashStyleType.js"],"names":["module","angular","ngeoMapModule","name","ngeoMiscDebounce","ngeoStatemanagerModule","mapComponent","controller","bindings","template","component","MapComponentController","ngeoLocation","ngeoDebounce","map","ngeoLocation_","ngeoDebounce_","prototype","$onInit","view","getView","zoom","getParam","undefined","x","y","center","setCenter","setZoom","updateParams","Math","round","on","e","getCenter","params","getZoom","drawComponent","DrawComponentController","$scope","layer","scope_","featureSeq_","interaction","vectorSource","getSource","olInteractionDraw","type","source","setActive","addInteraction","feature","set","fhFormat","ngeoFormatFeatureHash","setStyle","olStyleStyle","stroke","olStyleStroke","color","width","features","getFeatures","encodedFeatures","writeFeatures","$applyAsync","readFeatures","length","addFeatures","clearLayer","clear","deleteParam","MainController","olMap","layers","olLayerTile","olSourceOSM","olSourceVector","vectorLayer","olLayerVector","setMap","LegacyProperties_","DEFAULT_ACCURACY","StyleTypes_","ngeoFormatFeatureHashStyleType","LINE_STRING","POINT","POLYGON","CHAR64_","GEOMETRY_READERS_","readMultiPointGeometry_","readMultiLineStringGeometry_","readMultiPolygonGeometry_","readLineStringGeometry_","readPointGeometry_","readPolygonGeometry_","GEOMETRY_WRITERS_","writeMultiLineStringGeometry_","writeMultiPointGeometry_","writeMultiPolygonGeometry_","writeLineStringGeometry_","writePointGeometry_","writePolygonGeometry_","opt_options","options","accuracy_","accuracy","encodeStyles_","encodeStyles","propertiesFunction_","properties","defaultPropertiesFunction_","setStyle_","prevX_","prevY_","propertiesType","defaultValues_","defaultValues","decodeCoordinates_","text","opt_flatCoordinates","len","index","flatCoordinates","i","b","shift","result","indexOf","charAt","dx","dy","encodeCoordinates_","stride","offset","end","encodedCoordinates","floor","encodeSignedNumber_","readFeatureFromText","console","assert","splitIndex","geometryText","substring","geometry","readGeometryFromText","olFeature","attributesAndStylesText","attributesText","parts","split","part","decodeURIComponent","keyVal","key","value","castValue_","stylesText","setStyleInFeature_","setStyleProperties_","readFeaturesFromText","push","forEach","property","get","call","geometryReader","writeFeatureText","encodedParts","encodedGeometry","getGeometry","writeGeometryText","encodedProperties","propFunction","getGeometryName","encoded","encodeURIComponent","replace","toString","Array","apply","styleFunction","getStyleFunction","styles","encodedStyles","isArray","getType","join","writeFeaturesText","textArray","ii","geometryWriter","transformedGeometry","olFormatFeature","olFormatTextFeature","getProperties","num","signedNum","encodeNumber_","encodedNumber","geometryType","styleType","style","fillStyle","getFill","imageStyle","getImage","strokeStyle","getStroke","textStyle","getText","encodeStylePolygon_","encodeStyleLine_","encodeStylePoint_","encodeStyleText_","encodeStyleStroke_","olStyleCircle","radius","getRadius","encodeStyleFill_","opt_propertyName","propertyName","fillColor","getColor","fillColorRgba","olColor","fillColorHex","rgbArrayToHex","strokeColor","strokeColorRgba","strokeColorHex","strokeWidth","getWidth","fontStyle","getFont","font","olGeomLineString","olGeomGeometryLayout","XY","ends","lineStrings","olGeomMultiLineString","olGeomPoint","olGeomMultiPoint","rings","olGeomPolygon","endss","polygons","j","jj","olGeomMultiPolygon","getStyleProperties_","fontSize","fontColor","pointRadius","olStyleFill","fill","olStyleText","image","ngeoFormatFeatureProperties","IS_TEXT","parseFloat","clone","setProperties","numProperties","ANGLE","OPACITY","SIZE","STROKE","boolProperties","IS_CIRCLE","IS_RECTANGLE","SHOW_MEASURE","SHOW_LABEL","includes","val","getFlatCoordinates","getStride","getEnds","lineStringCount","encodeRings_","linearRingCount","getEndss","polygonCount"],"mappings":";AAAA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,gBAAQ,oBAAoB;AAC5B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAiB,4BAA4B;AAC7C;AACA;AACA,0BAAkB,2BAA2B;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,kDAA0C,gCAAgC;AAC1E;AACA;;AAEA;AACA;AACA;AACA,gEAAwD,kBAAkB;AAC1E;AACA,yDAAiD,cAAc;AAC/D;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iDAAyC,iCAAiC;AAC1E,wHAAgH,mBAAmB,EAAE;AACrI;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;AACA;AACA;AACA,wBAAgB,uBAAuB;AACvC;;;AAGA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACtJA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAIA,IAAMA,MAAM,GAAGC,8CAAO,CAACD,MAAR,CAAe,KAAf,EAAsB,CACnC,SADmC,EAEnCE,0DAAa,CAACC,IAFqB,EAGnCC,6DAAgB,CAACD,IAHkB,EAInCE,mEAAsB,CAACF,IAJY,CAAtB,CAAf;AAiBA,IAAMG,YAAY,GAAG;AACnBC,YAAU,EAAE,0BADO;AAEnBC,UAAQ,EAAE;AACR,WAAO;AADC,GAFS;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","file":"permalink.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"permalink\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([31,\"commons\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import './permalink.css';\nimport angular from 'angular';\nimport ngeoFormatFeatureHash from 'ngeo/format/FeatureHash.js';\n\nimport ngeoMapModule from 'ngeo/map/module.js';\nimport ngeoMiscDebounce from 'ngeo/misc/debounce.js';\nimport {interaction} from 'ngeo/misc/decorate.js';\nimport ngeoStatemanagerModule from 'ngeo/statemanager/module.js';\nimport olMap from 'ol/Map.js';\nimport olInteractionDraw from 'ol/interaction/Draw.js';\nimport olLayerTile from 'ol/layer/Tile.js';\nimport olLayerVector from 'ol/layer/Vector.js';\nimport olSourceOSM from 'ol/source/OSM.js';\nimport olSourceVector from 'ol/source/Vector.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\n\n\n/** @type {!angular.IModule} **/\nconst module = angular.module('app', [\n  'gettext',\n  ngeoMapModule.name,\n  ngeoMiscDebounce.name,\n  ngeoStatemanagerModule.name,\n]);\n\n/**\n * An application-specific map component that updates the URL in the browser\n * address bar when the map view changes. It also sets the initial view based\n * on the URL query params at init time.\n *\n * This component gets a reference to the map instance through the \"app-map\"\n * attribute.\n *\n * @type {!angular.IComponentOptions}\n */\nconst mapComponent = {\n  controller: 'AppMapController as ctrl',\n  bindings: {\n    'map': '=appMap'\n  },\n  template: '<div ngeo-map=ctrl.map></div>'\n};\n\n\nmodule.component('appMap', mapComponent);\n\n\n/**\n * @param {import(\"ngeo/statemanager/Location.js\").default} ngeoLocation ngeo Location service.\n * @param {import(\"ngeo/misc/debounce.js\").miscDebounce<function(): void>} ngeoDebounce ngeo Debounce factory.\n * @constructor\n * @ngInject\n */\nfunction MapComponentController(ngeoLocation, ngeoDebounce) {\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   * @export\n   */\n  this.map;\n\n  /**\n   * @type {import(\"ngeo/statemanager/Location.js\").default}\n   * @private\n   */\n  this.ngeoLocation_ = ngeoLocation;\n\n  /**\n   * @type {import(\"ngeo/misc/debounce.js\").miscDebounce<function(): void>}\n   * @private\n   */\n  this.ngeoDebounce_ = ngeoDebounce;\n}\n\nmodule.controller('AppMapController', MapComponentController);\n\nMapComponentController.prototype.$onInit = function() {\n  const view = this.map.getView();\n\n  let zoom = this.ngeoLocation_.getParam('z');\n  zoom = zoom !== undefined ? +zoom : 4;\n\n  const x = this.ngeoLocation_.getParam('x');\n  const y = this.ngeoLocation_.getParam('y');\n  const center = (x !== undefined) && (y !== undefined) ?\n    [+x, +y] : [0, 0];\n\n  view.setCenter(center);\n  view.setZoom(zoom);\n\n  this.ngeoLocation_.updateParams({\n    'z': zoom,\n    'x': Math.round(center[0]),\n    'y': Math.round(center[1])\n  });\n\n  view.on('propertychange',\n    this.ngeoDebounce_(\n      /**\n       * @param {import(\"ol/Object/Event.js\").default} e Object event.\n       */\n      (e) => {\n        const center = view.getCenter();\n        const params = {\n          'z': view.getZoom(),\n          'x': Math.round(center[0]),\n          'y': Math.round(center[1])\n        };\n        this.ngeoLocation_.updateParams(params);\n      }, 300, /* invokeApply */ true));\n};\n\n/**\n * A draw component that adds a simple draw tool.\n *\n * @type {!angular.IComponentOptions}\n */\nconst drawComponent = {\n  controller: 'AppDrawController as ctrl',\n  bindings: {\n    'map': '=appDrawMap',\n    'layer': '=appDrawLayer'\n  },\n  template:\n      '<label>Enable drawing:' +\n      '<input type=\"checkbox\" ng-model=\"ctrl.interaction.active\" />' +\n      '</label><br>' +\n      '<button ng-click=\"ctrl.clearLayer()\">Clear layer</button>'\n};\n\n\nmodule.component('appDraw', drawComponent);\n\n\n/**\n * @param {!angular.IScope} $scope Scope.\n * @param {!import(\"ngeo/statemanager/Location.js\").default} ngeoLocation ngeo Location service.\n * @constructor\n * @export\n * @ngInject\n */\nfunction DrawComponentController($scope, ngeoLocation) {\n\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   * @export\n   */\n  this.map;\n\n  /**\n   * @type {import(\"ol/layer/Vector.js\").default}\n   */\n  this.layer;\n\n  /**\n   * @type {!import(\"ngeo/statemanager/Location.js\").default}\n   * @private\n   */\n  this.ngeoLocation_ = ngeoLocation;\n\n  /**\n   * @type {!angular.IScope}\n   * @private\n   */\n  this.scope_ = $scope;\n\n  /**\n   * @type {number}\n   * @private\n   */\n  this.featureSeq_ = 0;\n\n  /**\n   * @type {import(\"ol/interaction/Draw.js\").default}\n   * @export\n   */\n  this.interaction;\n}\n\nDrawComponentController.prototype.$onInit = function() {\n  const vectorSource = this.layer.getSource();\n\n  this.interaction = new olInteractionDraw({\n    type: /** @type {import(\"ol/geom/GeometryType.js\").default} */ ('LineString'),\n    source: vectorSource\n  });\n\n  this.interaction.setActive(false);\n  this.map.addInteraction(this.interaction);\n  interaction(this.interaction);\n\n  this.interaction.on('drawend', function(e) {\n    e.feature.set('id', ++this.featureSeq_);\n  }, this);\n\n  // Deal with the encoding and decoding of features in the URL.\n\n  const fhFormat = new ngeoFormatFeatureHash();\n\n  vectorSource.on('addfeature', (e) => {\n    const feature = e.feature;\n    feature.setStyle(new olStyleStyle({\n      stroke: new olStyleStroke({\n        color: [255, 0, 0, 1],\n        width: 2\n      })\n    }));\n    const features = vectorSource.getFeatures();\n    const encodedFeatures = fhFormat.writeFeatures(features);\n    this.scope_.$applyAsync(() => {\n      this.ngeoLocation_.updateParams({'features': encodedFeatures});\n    });\n  });\n\n  const encodedFeatures = this.ngeoLocation_.getParam('features');\n  if (encodedFeatures !== undefined) {\n    const features = fhFormat.readFeatures(encodedFeatures);\n    this.featureSeq_ = features.length;\n    vectorSource.addFeatures(features);\n  }\n};\n\n\n/**\n * Clear the vector layer.\n * @export\n */\nDrawComponentController.prototype.clearLayer = function() {\n  this.layer.getSource().clear(true);\n  this.featureSeq_ = 0;\n  this.ngeoLocation_.deleteParam('features');\n};\n\nmodule.controller('AppDrawController', DrawComponentController);\n\n\n/**\n * @constructor\n */\nfunction MainController() {\n\n  /**\n   * @type {import(\"ol/Map.js\").default}\n   * @export\n   */\n  this.map = new olMap({\n    layers: [\n      new olLayerTile({\n        source: new olSourceOSM()\n      })\n    ]\n  });\n\n\n  const vectorSource = new olSourceVector();\n\n  /**\n   * @type {import(\"ol/layer/Vector.js\").default}\n   * @export\n   */\n  this.vectorLayer = new olLayerVector({\n    source: vectorSource\n  });\n\n  // Use vectorLayer.setMap(map) rather than map.addLayer(vectorLayer). This\n  // makes the vector layer \"unmanaged\", meaning that it is always on top.\n  this.vectorLayer.setMap(this.map);\n\n}\n\n\nmodule.controller('MainController', MainController);\n\n\nexport default module;\n","import ngeoFormatFeatureProperties from 'ngeo/format/FeatureProperties.js';\nimport ngeoFormatFeatureHashStyleType from 'ngeo/format/FeatureHashStyleType.js';\nimport {rgbArrayToHex} from 'ngeo/utils.js';\nimport olFeature from 'ol/Feature.js';\nimport * as olColor from 'ol/color.js';\nimport * as olFormatFeature from 'ol/format/Feature.js';\nimport olFormatTextFeature from 'ol/format/TextFeature.js';\nimport olGeomGeometryLayout from 'ol/geom/GeometryLayout.js';\nimport olGeomLineString from 'ol/geom/LineString.js';\nimport olGeomMultiLineString from 'ol/geom/MultiLineString.js';\nimport olGeomMultiPoint from 'ol/geom/MultiPoint.js';\nimport olGeomMultiPolygon from 'ol/geom/MultiPolygon.js';\nimport olGeomPoint from 'ol/geom/Point.js';\nimport olGeomPolygon from 'ol/geom/Polygon.js';\nimport olStyleCircle from 'ol/style/Circle.js';\nimport olStyleFill from 'ol/style/Fill.js';\nimport olStyleStroke from 'ol/style/Stroke.js';\nimport olStyleStyle from 'ol/style/Style.js';\nimport olStyleText from 'ol/style/Text.js';\n\n\n/**\n * accuracy: The encoding and decoding accuracy. Optional. Default value is 1.\n *\n * @typedef {Object} FeatureHashOptions\n * @property {number} [accuracy] The encoding and decoding accuracy. Optional. Default value is 1.\n * @property {Object.<string, function(import(\"ol/Feature.js\").default)>} [defaultValues] defaultValues.\n * @property {boolean} [encodeStyles] Encode styles. Optional. Default is `true`.\n * @property {function(import(\"ol/Feature.js\").default): Object.<string, (string|undefined)>} [properties] A function that\n * returns serializable properties for a feature. Optional. By default the feature properties (as returned\n * by `feature.getProperties()`) are used. To be serializable the returned properties should be numbers or\n * strings.\n * @property {boolean} [setStyle] Determines whether the style defined for each feature is read and converted\n * into:\n *   A) an `ol.style.Style` object set in the feature, or\n *   B) an object with key:values that defines the style properties set in the feature and for the\n *      `ngeo.misc.FeatureHelper` to use to style the feature with.\n * Default is `true`, i.e. A).\n */\n\n\n/**\n * @type {Object.<string, string>}\n * @private\n */\nlet LegacyProperties_ = {};\n\n\n/**\n * @const\n * @private\n */\nconst DEFAULT_ACCURACY = 0.1;\n\n\n/**\n * @type {Object.<import(\"ol/geom/GeometryType.js\").default, import(\"ngeo/format/FeatureHashStyleType.js\").default>}\n * @private\n */\nconst StyleTypes_ = {\n  'LineString': ngeoFormatFeatureHashStyleType.LINE_STRING,\n  'Point': ngeoFormatFeatureHashStyleType.POINT,\n  'Polygon': ngeoFormatFeatureHashStyleType.POLYGON,\n  'MultiLineString': ngeoFormatFeatureHashStyleType.LINE_STRING,\n  'MultiPoint': ngeoFormatFeatureHashStyleType.POINT,\n  'MultiPolygon': ngeoFormatFeatureHashStyleType.POLYGON\n};\n\n\n/**\n * Characters used to encode the coordinates. The characters \"~\", \"'\", \"(\"\n * and \")\" are not part of this character set, and used as separators (for\n * example to separate the coordinates from the feature properties).\n * @const\n * @private\n */\nconst CHAR64_ =\n    '.-_!*ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghjkmnpqrstuvwxyz';\n\n\n/**\n * @const\n * @private\n * @type {Object.<string, function(string):import(\"ol/geom/Geometry.js\").default>}\n */\nconst GEOMETRY_READERS_ = {\n  'P': readMultiPointGeometry_,\n  'L': readMultiLineStringGeometry_,\n  'A': readMultiPolygonGeometry_,\n  'l': readLineStringGeometry_,\n  'p': readPointGeometry_,\n  'a': readPolygonGeometry_\n};\n\n\n/**\n * @const\n * @private\n * @type {Object.<string, function(import(\"ol/geom/Geometry.js\").default):string>}\n */\nconst GEOMETRY_WRITERS_ = {\n  'MultiLineString': writeMultiLineStringGeometry_,\n  'MultiPoint': writeMultiPointGeometry_,\n  'MultiPolygon': writeMultiPolygonGeometry_,\n  'LineString': writeLineStringGeometry_,\n  'Point': writePointGeometry_,\n  'Polygon': writePolygonGeometry_\n};\n\n/**\n * Provide an OpenLayers format for encoding and decoding features for use\n * in permalinks.\n *\n * The code is based on Stéphane Brunner's URLCompressed format.\n *\n * TODOs:\n *\n * - The OpenLayers-URLCompressed format has options where the user\n *   can define attribute and style transformers. This is currently\n *   not supported by this format.\n * - The OpenLayers-URLCompressed format has a \"simplify\" option.\n *   This format does not have it.\n * - ol.style.Icon styles are not supported.\n * - Transformation of coordinates during encoding and decoding is\n *   not supported.\n *\n * @see https://github.com/sbrunner/OpenLayers-URLCompressed\n */\nexport default class extends olFormatTextFeature {\n  /**\n   * @param {FeatureHashOptions=} opt_options Options.\n   */\n  constructor(opt_options) {\n    super();\n\n    const options = opt_options !== undefined ? opt_options : {};\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.accuracy_ = options.accuracy !== undefined ?\n      options.accuracy : DEFAULT_ACCURACY;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.encodeStyles_ = options.encodeStyles !== undefined ?\n      options.encodeStyles : true;\n\n    /**\n     * @type {function(import(\"ol/Feature.js\").default):Object.<string, (string|number)>}\n     * @private\n     */\n    this.propertiesFunction_ = options.properties !== undefined ?\n      options.properties : defaultPropertiesFunction_;\n\n    /**\n     * @type {boolean}\n     * @private\n     */\n    this.setStyle_ = options.setStyle !== undefined ? options.setStyle : true;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.prevX_ = 0;\n\n    /**\n     * @type {number}\n     * @private\n     */\n    this.prevY_ = 0;\n\n    /**\n     * @type {Object.<string, string>}\n     * @private\n     */\n    LegacyProperties_ = (options.propertiesType !== undefined) && options.propertiesType;\n\n    /**\n     * @type {Object.<string, function(import(\"ol/Feature.js\").default)>}\n     * @private\n     */\n    this.defaultValues_ = options.defaultValues !== undefined ? options.defaultValues : {};\n  }\n\n  /**\n   * Read a logical sequence of characters and return (or complete then return)\n   * an array of numbers. The coordinates are assumed to be in\n   * two dimensions and in latitude, longitude order.\n   * corresponding to a geometry's coordinates.\n   * @param {string} text Text.\n   * @param {Array.<number>=} opt_flatCoordinates Flat coordinates array.\n   * @return {Array.<number>} Flat coordinates.\n   * @private\n   */\n  decodeCoordinates_(text, opt_flatCoordinates) {\n    const len = text.length;\n    let index = 0;\n    const flatCoordinates = opt_flatCoordinates !== undefined ?\n      opt_flatCoordinates : [];\n    let i = flatCoordinates.length;\n    while (index < len) {\n      let b;\n      let shift = 0;\n      let result = 0;\n      do {\n        b = CHAR64_.indexOf(text.charAt(index++));\n        result |= (b & 0x1f) << shift;\n        shift += 5;\n      } while (b >= 32);\n      const dx = ((result & 1) ? ~(result >> 1) : (result >> 1));\n      this.prevX_ += dx;\n      shift = 0;\n      result = 0;\n      do {\n        b = CHAR64_.indexOf(text.charAt(index++));\n        result |= (b & 0x1f) << shift;\n        shift += 5;\n      } while (b >= 32);\n      const dy = ((result & 1) ? ~(result >> 1) : (result >> 1));\n      this.prevY_ += dy;\n      flatCoordinates[i++] = this.prevX_ * this.accuracy_;\n      flatCoordinates[i++] = this.prevY_ * this.accuracy_;\n    }\n    return flatCoordinates;\n  }\n\n  /**\n   * Encode an array of number (corresponding to some coordinates) into a\n   * logical sequence of characters. The coordinates are assumed to be in\n   * two dimensions and in latitude, longitude order.\n   * @param {Array.<number>} flatCoordinates Flat coordinates.\n   * @param {number} stride Stride.\n   * @param {number} offset Offset.\n   * @param {number} end End.\n   * @return {string} String.\n   * @private\n   */\n  encodeCoordinates_(flatCoordinates, stride, offset, end) {\n    let encodedCoordinates = '';\n    for (let i = offset; i < end; i += stride) {\n      let x = flatCoordinates[i];\n      let y = flatCoordinates[i + 1];\n      x = Math.floor(x / this.accuracy_);\n      y = Math.floor(y / this.accuracy_);\n      const dx = x - this.prevX_;\n      const dy = y - this.prevY_;\n      this.prevX_ = x;\n      this.prevY_ = y;\n      encodedCoordinates += encodeSignedNumber_(dx) +\n          encodeSignedNumber_(dy);\n    }\n    return encodedCoordinates;\n  }\n\n  /**\n   * Read a feature from a logical sequence of characters.\n   * @param {string} text Text.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {import(\"ol/Feature.js\").default} Feature.\n   * @protected\n   * @override\n   */\n  readFeatureFromText(text, opt_options) {\n    console.assert(text.length > 2);\n    console.assert(text[1] === '(');\n    console.assert(text[text.length - 1] === ')');\n    let splitIndex = text.indexOf('~');\n    const geometryText = splitIndex >= 0 ?\n      `${text.substring(0, splitIndex)})` : text;\n    const geometry = this.readGeometryFromText(geometryText, opt_options);\n    const feature = new olFeature(geometry);\n    if (splitIndex >= 0) {\n      const attributesAndStylesText = text.substring(\n        splitIndex + 1, text.length - 1);\n      splitIndex = attributesAndStylesText.indexOf('~');\n      const attributesText = splitIndex >= 0 ?\n        attributesAndStylesText.substring(0, splitIndex) :\n        attributesAndStylesText;\n      if (attributesText != '') {\n        const parts = attributesText.split('\\'');\n        for (let i = 0; i < parts.length; ++i) {\n          const part = decodeURIComponent(parts[i]);\n          const keyVal = part.split('*');\n          console.assert(keyVal.length === 2);\n          let key = keyVal[0];\n          const value = keyVal[1];\n          if (!this.setStyle_ && LegacyProperties_[key]) {\n            key = LegacyProperties_[key];\n          }\n          feature.set(key, castValue_(key, value));\n        }\n      }\n      if (splitIndex >= 0) {\n        const stylesText = attributesAndStylesText.substring(splitIndex + 1);\n        if (this.setStyle_) {\n          setStyleInFeature_(stylesText, feature);\n        } else {\n          setStyleProperties_(stylesText, feature);\n        }\n      }\n    }\n    return feature;\n  }\n\n  /**\n   * Read multiple features from a logical sequence of characters.\n   * @param {string} text Text.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {Array.<import(\"ol/Feature.js\").default>} Features.\n   * @protected\n   * @override\n   */\n  readFeaturesFromText(text, opt_options) {\n    console.assert(text[0] === 'F');\n    this.prevX_ = 0;\n    this.prevY_ = 0;\n    /** @type {Array.<import(\"ol/Feature.js\").default>} */\n    const features = [];\n    text = text.substring(1);\n    while (text.length > 0) {\n      const index = text.indexOf(')');\n      console.assert(index >= 0);\n      const feature = this.readFeatureFromText(\n        text.substring(0, index + 1), opt_options);\n      features.push(feature);\n      text = text.substring(index + 1);\n    }\n\n    // set default values\n    features.forEach((feature) => {\n      for (const key in this.defaultValues_) {\n        const property = LegacyProperties_[key];\n        if (feature.get(property) === undefined) {\n          feature.set(property, this.defaultValues_[key].call(null, feature));\n        }\n      }\n    });\n    return features;\n  }\n\n  /**\n   * Read a geometry from a logical sequence of characters.\n   * @param {string} text Text.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {import(\"ol/geom/Geometry.js\").default} Geometry.\n   * @protected\n   * @override\n   */\n  readGeometryFromText(text, opt_options) {\n    const geometryReader = GEOMETRY_READERS_[text[0]];\n    console.assert(geometryReader !== undefined);\n    return geometryReader.call(this, text);\n  }\n\n  /**\n   * Encode a feature into a logical sequence of characters.\n   * @param {import(\"ol/Feature.js\").default} feature Feature.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {string} Encoded feature.\n   * @protected\n   * @override\n   */\n  writeFeatureText(feature, opt_options) {\n    const /** @type {Array.<string>} */ encodedParts = [];\n\n    // encode geometry\n\n    let encodedGeometry = '';\n    const geometry = feature.getGeometry();\n    if (geometry) {\n      encodedGeometry = this.writeGeometryText(geometry, opt_options);\n    }\n\n    if (encodedGeometry.length > 0) {\n      // remove the final bracket\n      console.assert(encodedGeometry[encodedGeometry.length - 1] === ')');\n      encodedGeometry = encodedGeometry.substring(0, encodedGeometry.length - 1);\n      encodedParts.push(encodedGeometry);\n    }\n\n    // encode properties\n\n    const /** @type {Array.<string>} */ encodedProperties = [];\n    const propFunction = this.propertiesFunction_(feature);\n    for (const key in propFunction) {\n      const value = propFunction[key];\n      if (value !== undefined && value !== null && key !== feature.getGeometryName()) {\n        if (encodedProperties.length !== 0) {\n          encodedProperties.push('\\'');\n        }\n        const encoded = encodeURIComponent(\n          `${key.replace(/[()'*]/g, '_')}*${\n            value.toString().replace(/[()'*]/g, '_')}`);\n        encodedProperties.push(encoded);\n      }\n    }\n\n    if (encodedProperties.length > 0) {\n      encodedParts.push('~');\n      Array.prototype.push.apply(encodedParts, encodedProperties);\n    }\n\n    // encode styles\n\n    if (this.encodeStyles_) {\n      const styleFunction = feature.getStyleFunction();\n      if (styleFunction !== undefined) {\n        let styles = styleFunction.call(feature, 0);\n        if (styles !== null) {\n          const encodedStyles = [];\n          styles = Array.isArray(styles) ? styles : [styles];\n          encodeStyles_(\n            styles, geometry.getType(), encodedStyles);\n          if (encodedStyles.length > 0) {\n            encodedParts.push('~');\n            Array.prototype.push.apply(encodedParts, encodedStyles);\n          }\n        }\n      }\n    }\n\n    // append the closing bracket and return the encoded feature\n\n    encodedParts.push(')');\n    return encodedParts.join('');\n  }\n\n  /**\n   * Encode an array of features into a logical sequence of characters.\n   * @param {Array.<import(\"ol/Feature.js\").default>} features Feature.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {string} Encoded features.\n   * @protected\n   * @override\n   */\n  writeFeaturesText(features, opt_options) {\n    this.prevX_ = 0;\n    this.prevY_ = 0;\n    const textArray = [];\n    if (features.length > 0) {\n      textArray.push('F');\n      for (let i = 0, ii = features.length; i < ii; ++i) {\n        textArray.push(this.writeFeatureText(features[i], opt_options));\n      }\n    }\n    return textArray.join('');\n  }\n\n  /**\n   * Encode a geometry into a logical sequence of characters.\n   * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n   * @param {olx.format.ReadOptions=} opt_options Read options.\n   * @return {string} Encoded geometry.\n   * @protected\n   * @override\n   */\n  writeGeometryText(geometry, opt_options) {\n    const geometryWriter = GEOMETRY_WRITERS_[\n      geometry.getType()];\n    console.assert(geometryWriter !== undefined);\n    const transformedGeometry = /** @type {import(\"ol/geom/Geometry.js\").default} */\n        (olFormatFeature.transformWithOptions(geometry, true, opt_options));\n    return geometryWriter.call(this, transformedGeometry);\n  }\n}\n\n\n/**\n * Get features's properties.\n * @param {import(\"ol/Feature.js\").default} feature Feature.\n * @return {Object.<string, (string|number)>} The feature properties to\n * serialize.\n * @private\n */\nfunction defaultPropertiesFunction_(feature) {\n  return feature.getProperties();\n}\n\n/**\n * Sign then encode a number.\n * @param {number} num Number.\n * @return {string} String.\n * @private\n */\nfunction encodeSignedNumber_(num) {\n  let signedNum = num << 1;\n  if (num < 0) {\n    signedNum = ~(signedNum);\n  }\n  return encodeNumber_(signedNum);\n}\n\n/**\n * Transform a number into a logical sequence of characters.\n * @param {number} num Number.\n * @return {string} String.\n * @private\n */\nfunction encodeNumber_(num) {\n  let encodedNumber = '';\n  while (num >= 0x20) {\n    encodedNumber += CHAR64_.charAt(\n      0x20 | (num & 0x1f));\n    num >>= 5;\n  }\n  encodedNumber += CHAR64_.charAt(num);\n  return encodedNumber;\n}\n\n/**\n * For a type of geometry, transforms an array of {@link import(\"ol/style/Style.js\").default} into\n * a logical sequence of characters and put the result into the given encoded\n * styles's array.\n * @param {Array.<import(\"ol/style/Style.js\").default>} styles Styles.\n * @param {import(\"ol/geom/GeometryType.js\").default} geometryType Geometry type.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStyles_(styles, geometryType, encodedStyles) {\n  const styleType = StyleTypes_[geometryType];\n  console.assert(styleType !== undefined);\n  for (let i = 0; i < styles.length; ++i) {\n    const style = styles[i];\n    const fillStyle = style.getFill();\n    const imageStyle = style.getImage();\n    const strokeStyle = style.getStroke();\n    const textStyle = style.getText();\n    if (styleType == ngeoFormatFeatureHashStyleType.POLYGON) {\n      if (fillStyle !== null) {\n        encodeStylePolygon_(\n          fillStyle, strokeStyle, encodedStyles);\n      }\n    } else if (styleType == ngeoFormatFeatureHashStyleType.LINE_STRING) {\n      if (strokeStyle !== null) {\n        encodeStyleLine_(strokeStyle, encodedStyles);\n      }\n    } else if (styleType == ngeoFormatFeatureHashStyleType.POINT) {\n      if (imageStyle !== null) {\n        encodeStylePoint_(imageStyle, encodedStyles);\n      }\n    }\n    if (textStyle !== null) {\n      encodeStyleText_(textStyle, encodedStyles);\n    }\n  }\n}\n\n/**\n * Transform an {@link import(\"ol/style/Stroke.js\").default} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {import(\"ol/style/Stroke.js\").default} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStyleLine_(strokeStyle, encodedStyles) {\n  encodeStyleStroke_(strokeStyle, encodedStyles);\n}\n\n/**\n * Transform an {@link import(\"ol/style/Circle.js\").default} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {import(\"ol/style/Image.js\").default} imageStyle Image style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStylePoint_(imageStyle, encodedStyles) {\n  if (imageStyle instanceof olStyleCircle) {\n    const radius = imageStyle.getRadius();\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`pointRadius*${radius}`));\n    const fillStyle = imageStyle.getFill();\n    if (fillStyle !== null) {\n      encodeStyleFill_(fillStyle, encodedStyles);\n    }\n    const strokeStyle = imageStyle.getStroke();\n    if (strokeStyle !== null) {\n      encodeStyleStroke_(strokeStyle, encodedStyles);\n    }\n  }\n}\n\n/**\n * Transform an {@link import(\"ol/style/Fill.js\").default} and an {@link import(\"ol/style/Stroke.js\").default} into\n * a logical sequence of characters and put the result into the given\n * encoded styles's array.\n * @param {import(\"ol/style/Fill.js\").default} fillStyle Fill style.\n * @param {import(\"ol/style/Stroke.js\").default} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStylePolygon_(fillStyle, strokeStyle, encodedStyles) {\n  encodeStyleFill_(fillStyle, encodedStyles);\n  if (strokeStyle !== null) {\n    encodeStyleStroke_(strokeStyle, encodedStyles);\n  }\n}\n\n/**\n * Transform an {@link import(\"ol/style/Fill.js\").default} and optionally its properties into\n * a logical sequence of characters and put the result into the given encoded\n * styles's array.\n * @param {import(\"ol/style/Fill.js\").default} fillStyle Fill style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @param {string=} opt_propertyName Property name.\n * @private\n */\nfunction encodeStyleFill_(fillStyle, encodedStyles, opt_propertyName) {\n  const propertyName = opt_propertyName !== undefined ?\n    opt_propertyName : 'fillColor';\n  const fillColor = fillStyle.getColor();\n  if (fillColor !== null) {\n    console.assert(Array.isArray(fillColor), 'only supporting fill colors');\n    const fillColorRgba = olColor.asArray(fillColor);\n    console.assert(Array.isArray(fillColorRgba), 'fill color must be an array');\n    const fillColorHex = rgbArrayToHex(fillColorRgba);\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(\n      encodeURIComponent(`${propertyName}*${fillColorHex}`));\n  }\n}\n\n/**\n * Transform an {@link import(\"ol/style/Stroke.js\").default} into a logical sequence of\n * characters and put the result into the given encoded styles's array.\n * @param {import(\"ol/style/Stroke.js\").default} strokeStyle Stroke style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStyleStroke_(strokeStyle, encodedStyles) {\n  const strokeColor = strokeStyle.getColor();\n  if (strokeColor !== null) {\n    console.assert(Array.isArray(strokeColor));\n    const strokeColorRgba = olColor.asArray(strokeColor);\n    console.assert(Array.isArray(strokeColorRgba), 'only supporting stroke colors');\n    const strokeColorHex = rgbArrayToHex(strokeColorRgba);\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`strokeColor*${strokeColorHex}`));\n  }\n  const strokeWidth = strokeStyle.getWidth();\n  if (strokeWidth !== undefined) {\n    if (encodedStyles.length > 0) {\n      encodedStyles.push('\\'');\n    }\n    encodedStyles.push(encodeURIComponent(`strokeWidth*${strokeWidth}`));\n  }\n}\n\n/**\n * Transform an {@link import(\"ol/style/Text.js\").default} into a logical sequence of characters and\n * put the result into the given encoded styles's array.\n * @param {import(\"ol/style/Text.js\").default} textStyle Text style.\n * @param {Array.<string>} encodedStyles Encoded styles array.\n * @private\n */\nfunction encodeStyleText_(textStyle, encodedStyles) {\n  const fontStyle = textStyle.getFont();\n  if (fontStyle !== undefined) {\n    const font = fontStyle.split(' ');\n    if (font.length >= 3) {\n      if (encodedStyles.length > 0) {\n        encodedStyles.push('\\'');\n      }\n      encodedStyles.push(encodeURIComponent(`fontSize*${font[1]}`));\n    }\n  }\n  const fillStyle = textStyle.getFill();\n  if (fillStyle !== null) {\n    encodeStyleFill_(\n      fillStyle, encodedStyles, 'fontColor');\n  }\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/LineString.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/LineString.js\").default} Line string.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readLineStringGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'l(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  return new olGeomLineString(flatCoordinates, olGeomGeometryLayout.XY);\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/MultiLineString.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/MultiLineString.js\").default} Line string.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readMultiLineStringGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'L(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const ends = [];\n  const lineStrings = text.split('\\'');\n  for (let i = 0, ii = lineStrings.length; i < ii; ++i) {\n    flatCoordinates = this.decodeCoordinates_(lineStrings[i], flatCoordinates);\n    ends[i] = flatCoordinates.length;\n  }\n  return new olGeomMultiLineString(flatCoordinates, olGeomGeometryLayout.XY, ends);\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/Point.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/Point.js\").default} Point.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readPointGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'p(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  console.assert(flatCoordinates.length === 2);\n  return new olGeomPoint(flatCoordinates, olGeomGeometryLayout.XY);\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/MultiPoint.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/MultiPoint.js\").default} MultiPoint.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readMultiPointGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'P(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  const flatCoordinates = this.decodeCoordinates_(text);\n  return new olGeomMultiPoint(flatCoordinates, olGeomGeometryLayout.XY);\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/Polygon.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/Polygon.js\").default} Polygon.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readPolygonGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'a(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const ends = [];\n  const rings = text.split('\\'');\n  for (let i = 0, ii = rings.length; i < ii; ++i) {\n    flatCoordinates = this.decodeCoordinates_(rings[i], flatCoordinates);\n    let end = flatCoordinates.length;\n    if (i === 0) {\n      flatCoordinates[end++] = flatCoordinates[0];\n      flatCoordinates[end++] = flatCoordinates[1];\n    } else {\n      flatCoordinates[end++] = flatCoordinates[ends[i - 1]];\n      flatCoordinates[end++] = flatCoordinates[ends[i - 1] + 1];\n    }\n    ends[i] = end;\n  }\n  return new olGeomPolygon(flatCoordinates, olGeomGeometryLayout.XY, ends);\n}\n\n/**\n * Read a logical sequence of characters and return a corresponding\n * {@link import(\"ol/geom/MultiPolygon.js\").default}.\n * @param {string} text Text.\n * @return {import(\"ol/geom/MultiPolygon.js\").default} MultiPolygon.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction readMultiPolygonGeometry_(text) {\n  console.assert(text.substring(0, 2) === 'A(');\n  console.assert(text[text.length - 1] == ')');\n  text = text.substring(2, text.length - 1);\n  let flatCoordinates = [];\n  const endss = [];\n  const polygons = text.split(')(');\n  for (let i = 0, ii = polygons.length; i < ii; ++i) {\n    const rings = polygons[i].split('\\'');\n    const ends = endss[i] = [];\n    for (let j = 0, jj = rings.length; j < jj; ++j) {\n      flatCoordinates = this.decodeCoordinates_(rings[j], flatCoordinates);\n      let end = flatCoordinates.length;\n      if (j === 0) {\n        flatCoordinates[end++] = flatCoordinates[0];\n        flatCoordinates[end++] = flatCoordinates[1];\n      } else {\n        flatCoordinates[end++] = flatCoordinates[ends[j - 1]];\n        flatCoordinates[end++] = flatCoordinates[ends[j - 1] + 1];\n      }\n      ends[j] = end;\n    }\n  }\n  return new olGeomMultiPolygon(flatCoordinates, olGeomGeometryLayout.XY, endss);\n}\n\n/**\n * DEPRECATED - Use the `ngeo.misc.FeatureHelper` instead in combination with the\n * `setStyle: false` option.\n *\n * Read a logical sequence of characters and apply the decoded style on the\n * given feature.\n * @param {string} text Text.\n * @param {import(\"ol/Feature.js\").default} feature Feature.\n * @private\n */\nfunction setStyleInFeature_(text, feature) {\n  if (text == '') {\n    return;\n  }\n  const properties = getStyleProperties_(text, feature);\n  const fillColor = properties['fillColor'];\n  const fontSize = properties['fontSize'];\n  const fontColor = properties['fontColor'];\n  const pointRadius = properties['pointRadius'];\n  const strokeColor = properties['strokeColor'];\n  const strokeWidth = properties['strokeWidth'];\n\n  let fillStyle = null;\n  if (fillColor !== undefined) {\n    fillStyle = new olStyleFill({\n      color: /** @type {Array<number>|string} */ (fillColor)\n    });\n  }\n  let strokeStyle = null;\n  if (strokeColor !== undefined && strokeWidth !== undefined) {\n    strokeStyle = new olStyleStroke({\n      color: /** @type {Array<number>|string} */ (strokeColor),\n      width: /** @type {number} */ (strokeWidth)\n    });\n  }\n  let imageStyle = null;\n  if (pointRadius !== undefined) {\n    imageStyle = new olStyleCircle({\n      radius: /** @type {number} */ (pointRadius),\n      fill: fillStyle,\n      stroke: strokeStyle\n    });\n    fillStyle = strokeStyle = null;\n  }\n  let textStyle = null;\n  if (fontSize !== undefined && fontColor !== undefined) {\n    textStyle = new olStyleText({\n      font: `${fontSize} sans-serif`,\n      fill: new olStyleFill({\n        color: /** @type {Array<number>|string} */ (fontColor)\n      })\n    });\n  }\n  const style = new olStyleStyle({\n    fill: fillStyle,\n    image: imageStyle,\n    stroke: strokeStyle,\n    text: textStyle\n  });\n  feature.setStyle(style);\n}\n\n/**\n * Read a logical sequence of characters and apply the decoded result as\n * style properties for the feature. Legacy keys are converted to the new ones\n * for compatibility.\n * @param {string} text Text.\n * @param {import(\"ol/Feature.js\").default} feature Feature.\n * @private\n */\nfunction setStyleProperties_(text, feature) {\n\n  const properties = getStyleProperties_(text, feature);\n  const geometry = feature.getGeometry();\n\n  // Deal with legacy properties\n  if (geometry instanceof olGeomPoint) {\n    if (properties['isLabel'] ||\n        properties[ngeoFormatFeatureProperties.IS_TEXT]) {\n      delete properties['strokeColor'];\n      delete properties['fillColor'];\n    } else {\n      delete properties['fontColor'];\n      delete properties['fontSize'];\n    }\n  } else {\n    delete properties['fontColor'];\n\n    if (geometry instanceof olGeomLineString) {\n      delete properties['fillColor'];\n      delete properties['fillOpacity'];\n    }\n  }\n\n  // Convert font size from px to pt\n  if (properties['fontSize']) {\n    let fontSize = parseFloat(properties['fontSize']);\n    if (properties['fontSize'].indexOf('px') !== -1) {\n      fontSize = Math.round(fontSize / 1.333333);\n    }\n    properties['fontSize'] = fontSize;\n  }\n\n  // Convert legacy properties\n  const clone = {};\n  for (const key in properties) {\n    const value = properties[key];\n    if (LegacyProperties_[key]) {\n      clone[LegacyProperties_[key]] = value;\n    } else {\n      clone[key] = value;\n    }\n  }\n\n  feature.setProperties(clone);\n}\n\n/**\n * Cast values in the correct type depending on the property.\n * @param {string} key Key.\n * @param {string} value Value.\n * @return {number|boolean|string} The casted value corresponding to the key.\n * @private\n */\nfunction castValue_(key, value) {\n  const numProperties = [\n    ngeoFormatFeatureProperties.ANGLE,\n    ngeoFormatFeatureProperties.OPACITY,\n    ngeoFormatFeatureProperties.SIZE,\n    ngeoFormatFeatureProperties.STROKE,\n    'pointRadius',\n    'strokeWidth'\n  ];\n  const boolProperties = [\n    ngeoFormatFeatureProperties.IS_CIRCLE,\n    ngeoFormatFeatureProperties.IS_RECTANGLE,\n    ngeoFormatFeatureProperties.IS_TEXT,\n    ngeoFormatFeatureProperties.SHOW_MEASURE,\n    ngeoFormatFeatureProperties.SHOW_LABEL,\n    'isCircle',\n    'isRectangle',\n    'isLabel',\n    'showMeasure',\n    'showLabel'\n  ];\n\n  if (numProperties.includes(key)) {\n    return +value;\n  } else if (boolProperties.includes(key)) {\n    return (value === 'true') ? true : false;\n  } else {\n    return value;\n  }\n}\n\n/**\n * From a logical sequence of characters, create and return an object of\n * style properties for a feature. The values are cast in the correct type\n * depending on the property. Some properties are also deleted when they don't\n * match the geometry of the feature.\n * @param {string} text Text.\n * @param {import(\"ol/Feature.js\").default} feature Feature.\n * @return {Object.<string, boolean|number|string>} The style properties for\n *     the feature.\n * @private\n */\nfunction getStyleProperties_(text, feature) {\n  const parts = text.split('\\'');\n  const properties = {};\n\n  for (let i = 0; i < parts.length; ++i) {\n    const part = decodeURIComponent(parts[i]);\n    const keyVal = part.split('*');\n    console.assert(keyVal.length === 2);\n    const key = keyVal[0];\n    const val = keyVal[1];\n\n    properties[key] = castValue_(key, val);\n  }\n\n  return properties;\n}\n\n/**\n * Encode a {@link import(\"ol/geom/LineString.js\").default} geometry into a logical sequence of\n * characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writeLineStringGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomLineString);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `l(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n}\n\n/**\n * Encode a {@link import(\"ol/geom/MultiLineString.js\").default} geometry into a logical sequence\n * of characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writeMultiLineStringGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomMultiLineString);\n  const ends = geometry.getEnds();\n  const lineStringCount = ends.length;\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  let offset = 0;\n  const textArray = ['L('];\n  for (let i = 0; i < lineStringCount; ++i) {\n    const end = ends[i];\n    const text = this.encodeCoordinates_(flatCoordinates, stride, offset, end);\n    if (i !== 0) {\n      textArray.push('\\'');\n    }\n    textArray.push(text);\n    offset = end;\n  }\n  textArray.push(')');\n  return textArray.join('');\n}\n\n/**\n * Encode a {@link import(\"ol/geom/Point.js\").default} geometry into a logical sequence of\n * characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writePointGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomPoint);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `p(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n}\n\n/**\n * Encode an {@link import(\"ol/geom/MultiPoint.js\").default} geometry into a logical sequence\n * of characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writeMultiPointGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomMultiPoint);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const end = flatCoordinates.length;\n  return `P(${this.encodeCoordinates_(flatCoordinates, stride, 0, end)})`;\n}\n\n/**\n * Helper to encode an {@link import(\"ol/geom/Polygon.js\").default} geometry.\n * @param {Array.<number>} flatCoordinates Flat coordinates.\n * @param {number} stride Stride.\n * @param {number} offset Offset.\n * @param {Array.<number>} ends Ends.\n * @param {Array.<string>} textArray Text array.\n * @return {number} The new offset.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction encodeRings_(flatCoordinates, stride, offset, ends, textArray) {\n  const linearRingCount = ends.length;\n  for (let i = 0; i < linearRingCount; ++i) {\n    // skip the \"closing\" point\n    const end = ends[i] - stride;\n    const text = this.encodeCoordinates_(flatCoordinates, stride, offset, end);\n    if (i !== 0) {\n      textArray.push('\\'');\n    }\n    textArray.push(text);\n    offset = ends[i];\n  }\n  return offset;\n}\n\n/**\n * Encode an {@link import(\"ol/geom/Polygon.js\").default} geometry into a logical sequence\n * of characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writePolygonGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomPolygon);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const ends = geometry.getEnds();\n  const offset = 0;\n  const textArray = ['a('];\n  encodeRings_.call(this,\n    flatCoordinates, stride, offset, ends, textArray);\n  textArray.push(')');\n  return textArray.join('');\n}\n\n\n/**\n * Encode an {@link import(\"ol/geom/MultiPoligon.js\").default} geometry into a logical sequence of\n * characters.\n * @param {import(\"ol/geom/Geometry.js\").default} geometry Geometry.\n * @return {string} Encoded geometry.\n * @this {import(\"ngeo/format/FeatureHash.js\").default}\n * @private\n */\nfunction writeMultiPolygonGeometry_(geometry) {\n  console.assert(geometry instanceof olGeomMultiPolygon);\n  const flatCoordinates = geometry.getFlatCoordinates();\n  const stride = geometry.getStride();\n  const endss = geometry.getEndss();\n  const polygonCount = endss.length;\n  let offset = 0;\n  const textArray = ['A'];\n  for (let i = 0; i < polygonCount; ++i) {\n    const ends = endss[i];\n    textArray.push('(');\n    offset = encodeRings_.call(this,\n      flatCoordinates, stride, offset, ends, textArray);\n    textArray.push(')');\n  }\n  return textArray.join('');\n}\n","/**\n * @enum {string}\n * @export\n */\nexport default {\n  LINE_STRING: 'LineString',\n  POINT: 'Point',\n  POLYGON: 'Polygon'\n};\n"],"sourceRoot":""}